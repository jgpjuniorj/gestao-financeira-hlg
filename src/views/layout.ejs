
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gestão Financeira</title>
  <link rel="stylesheet" href="/css/styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script>
    // Alternância de tema claro/escuro
    function setTheme(theme) {
      document.body.classList.remove('light-theme', 'dark-theme');
      if (theme === 'light') {
        document.body.classList.add('light-theme');
        localStorage.setItem('theme', 'light');
      } else if (theme === 'dark') {
        document.body.classList.add('dark-theme');
        localStorage.setItem('theme', 'dark');
      } else {
        localStorage.removeItem('theme');
      }
    }
    function toggleTheme() {
      const isLight = document.body.classList.contains('light-theme');
      setTheme(isLight ? 'dark' : 'light');
      updateThemeButton();
    }
    function updateThemeButton() {
      const btn = document.getElementById('theme-toggle');
      if (!btn) return;
      if (document.body.classList.contains('light-theme')) {
        btn.textContent = 'Tema Escuro';
      } else {
        btn.textContent = 'Tema Claro';
      }
    }
    window.addEventListener('DOMContentLoaded', function() {
      const saved = localStorage.getItem('theme');
      if (saved === 'light' || saved === 'dark') setTheme(saved);
      updateThemeButton();
    });
  </script>
</head>
<body>
  <div class="layout">
    <header class="topbar">
      <div class="brand">
        <span class="brand-mark">GF</span>
        <div>
          <h1>Gestão Financeira</h1>
          <p>Visão total do seu orçamento em um só lugar</p>
        </div>
      </div>
      <button id="theme-toggle" onclick="toggleTheme()" style="margin-left:16px;padding:8px 16px;border-radius:8px;border:1px solid var(--border);background:var(--surface-alt);color:var(--text);cursor:pointer;">
        Tema
      </button>
      <% if (isAuthenticated) { %>
        <nav class="menu">
          <a href="/dashboard">Dashboard</a>
          <a href="/entries">Lançamentos</a>
          <a href="/manage">Gerenciar Dados</a>
          <% if (isAdmin) { %>
            <a href="/admin/households">Ambientes</a>
            <a href="/users">Usuários</a>
          <% } %>
          <form action="/logout" method="post" class="logout-form">
            <button type="submit">Sair</button>
          </form>
        </nav>
        <div class="session-indicator">
          <% if (currentHousehold?.name) { %>
            <span>Ambiente: <strong><%= currentHousehold.name %></strong></span>
          <% } %>
          <% if (currentUser?.username) { %>
            <span>Usuário: <strong><%= currentUser.username %></strong></span>
          <% } %>
          <% if (isAdmin) { %>
            <span class="badge-admin">Admin</span>
          <% } %>
        </div>
      <% } %>
    </header>

    <main class="content">
      <div class="content-inner">
        <%- body %>
      </div>
    </main>

    <footer class="footer">
      <small>Gestão Financeira — Node.js • Express • MariaDB • Chart.js</small>
    </footer>
  </div>
</body>
</html>
